# Production Values for ConsolPortals STC VCP
# Use this file as a template for production deployments

# Global settings - override for production environment
global:
  registry: nexus.telenity.com/com/telenity
  imagePrefix: consolportals-sa-stc-vcp
  imageTag: "1.0.0.2"  # Update to your production version
  imagePullPolicy: Always  # Always pull in production

namespace: stc-vcp-services-prod

# HTTPD - increased resources for production
httpd:
  enabled: true
  replicaCount: 3  # Higher replica count for HA
  image:
    repository: nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-httpd
    tag: "1.0.0.2"
    pullPolicy: Always
  
  service:
    type: ClusterIP
    ports:
      http: 80
      https: 443
  
  resources:
    limits:
      memory: "1Gi"
      cpu: "1000m"
    requests:
      memory: "512Mi"
      cpu: "500m"
  
  containerPorts:
    - containerPort: 80
      name: http
    - containerPort: 443
      name: https

# A3GW - production configuration
a3gw:
  enabled: true
  replicaCount: 3
  image:
    repository: nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-a3gw
    tag: "1.0.0.2"
    pullPolicy: Always
  
  service:
    type: ClusterIP
    sessionAffinity: ClientIP
    sessionAffinityTimeout: 10800
    ports:
      portals: 8444
      auth: 8445
  
  resources:
    limits:
      memory: "1Gi"
      cpu: "1000m"
    requests:
      memory: "512Mi"
      cpu: "500m"

# Admin Portal
adminportal:
  enabled: true
  replicaCount: 3
  image:
    repository: nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-adminportal
    tag: "1.0.0.2"
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 8080
  
  resources:
    limits:
      memory: "768Mi"
      cpu: "750m"
    requests:
      memory: "384Mi"
      cpu: "375m"

# CC Portal
ccportal:
  enabled: true
  replicaCount: 3
  image:
    repository: nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-ccportal
    tag: "1.0.0.2"
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 8081
  
  resources:
    limits:
      memory: "768Mi"
      cpu: "750m"
    requests:
      memory: "384Mi"
      cpu: "375m"

# Partner Portal
partnerportal:
  enabled: true
  replicaCount: 3
  image:
    repository: nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-partnerportal
    tag: "1.0.0.2"
    pullPolicy: Always
  
  service:
    type: ClusterIP
    port: 8082
  
  resources:
    limits:
      memory: "768Mi"
      cpu: "750m"
    requests:
      memory: "384Mi"
      cpu: "375m"

# Ingress - production domain configuration
ingress:
  enabled: true
  className: nginx
  
  httpd:
    enabled: true
    annotations:
      nginx.ingress.kubernetes.io/affinity: "cookie"
      nginx.ingress.kubernetes.io/session-cookie-name: "vcp-sticky"
      nginx.ingress.kubernetes.io/session-cookie-max-age: "10800"
      nginx.ingress.kubernetes.io/session-cookie-expires: "10800"
      nginx.ingress.kubernetes.io/session-cookie-path: "/"
      nginx.ingress.kubernetes.io/session-cookie-samesite: "Lax"
      nginx.ingress.kubernetes.io/proxy-body-size: "50m"  # Larger for production
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
      # SSL/TLS configuration
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    
    # Production domains
    hosts:
      - host: console.production.example.com
        paths:
          - path: /
            pathType: Prefix
    
    # Disable local development ingress
    local:
      enabled: false
  
  services:
    enabled: true
    portals:
      - path: /adminportal
        pathType: Prefix
      - path: /ccportal
        pathType: Prefix
      - path: /partnerportal
        pathType: Prefix
    other:
      - path: /conf
        pathType: Prefix
      - path: /site.json
        pathType: Prefix
    refreshToken:
      enabled: true
      path: /cmpf-auth-rest/refresh-token
      pathType: Prefix
      rewriteTarget: /refresh-token
    cmpfRest:
      enabled: true
      path: /cmpf-auth-rest
      pathType: Prefix
      rewriteTarget: /cmpf-rest/authenticate
    captcha:
      enabled: true
      path: /img/captcha.png
      pathType: Prefix
      rewriteTarget: /captcha.png
    vcpServices:
      enabled: true
      path: /vcp/services(/|$)(.*)
      pathType: Prefix
      rewriteTarget: /$2

# Pod Security Context - non-root user
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# Container Security Context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false  # Some apps may need write access

# Node affinity for specific node pools (if applicable)
nodeSelector:
  # node-type: application
  # environment: production

# Tolerations for tainted nodes (if applicable)
tolerations: []
  # - key: "dedicated"
  #   operator: "Equal"
  #   value: "application"
  #   effect: "NoSchedule"

# Anti-affinity to spread pods across nodes
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - consolportals-sa-stc-vcp
          topologyKey: kubernetes.io/hostname

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod Annotations for monitoring
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"

# Pod Labels
podLabels:
  environment: production
  team: platform
