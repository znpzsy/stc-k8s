<div class="portlet-header">
    <h4 class="portlet-title">
        {{ 'PartnerInfo.Reporting.Title' | translate }} / {{ $state.current.data.pageHeaderKey | translate }}
    </h4>
</div>

<form class="form-horizontal parsley-form" novalidate id="form" name="form" method="post" enctype="multipart/form-data">

    <span ng-include="'partner-info/reporting/reports/reporting.formfields.common.html'"></span>

    <hr>

    <div class="form-group" ng-show="reportCategory.intervals.length > 1">
        <label class="col-md-3">{{ 'PartnerInfo.Reporting.Type' | translate }}</label>
        <div class="col-md-3">
            <select class="form-control parsley-validated"
                    ng-model="interval" ng-options="opt as opt.name for opt in reportCategory.intervals">
            </select>
        </div>
    </div>

    <div class="form-group" ng-if="!interval.name.endsWith('_SPECIAL')">
        <label for="startDate" class="col-md-3 text-left">{{ ((interval.name === 'MINUTELY' || interval.name === 'HOURLY' || interval.name === 'ALL') ? 'PartnerInfo.Reporting.StartDateTime' : 'PartnerInfo.Reporting.StartDate') | translate }}</label>
        <div class="col-md-3">
            <p class="input-group datepicker-field">
                <input type="text" class="form-control input-sm" id="startDate" name="startDate"
                       uib-datepicker-popup="{{dateFormat}}" ng-model="dateHolder.startDate"
                       is-open="startDatePicker.opened"
                       datepicker-options="dateOptions" ng-required="true"
                       ng-change="updateStartDate(dateHolder.startDate)"/>
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default input-sm"
                            ng-click="openStartDatePicker($event)"><i
                            class="fa fa-calendar"></i></button>
                </span>
                <ul ng-class="{ 'parsley-error-list': form.startDate.$dirty && form.startDate.$invalid }" ng-show="form.startDate.$dirty && form.startDate.$invalid">
                    <li class="required" ng-show="form.startDate.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    <li class="required" ng-show="form.startDate.$error.parse">{{ 'GenericFormFields.StartDate.Messages.Invalid' | translate }}</li>
                </ul>
            </p>
        </div>
        <div class="col-md-4">
            <span class="time-picker with-date-picker" ng-if="(interval.name === 'MINUTELY' || interval.name === 'HOURLY' || interval.name === 'ALL')">
                <div uib-timepicker ng-model="dateHolder.startTime" hour-step="hstep" minute-step="mstep"
                            show-meridian="false" readonly-input="true" mousewheel="false"
                            ng-change="updateStartDateTime(dateHolder.startTime)"></div>
            </span>
        </div>
    </div>

    <div class="form-group" ng-if="!interval.name.endsWith('_SPECIAL')">
        <label for="endDate" class="col-md-3 text-left">{{ ((interval.name === 'MINUTELY' || interval.name === 'HOURLY' || interval.name === 'ALL') ? 'PartnerInfo.Reporting.EndDateTime' : 'PartnerInfo.Reporting.EndDate') | translate }}</label>
        <div class="col-md-3">
            <p class="input-group datepicker-field">
                <input type="text" class="form-control input-sm" id="endDate" name="endDate"
                       uib-datepicker-popup="{{dateFormat}}" ng-model="dateHolder.endDate"
                       is-open="endDatePicker.opened"
                       datepicker-options="dateOptions" ng-required="true"
                       ng-change="updateEndDate(dateHolder.endDate)"/>
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default input-sm" ng-click="openEndDatePicker($event)">
                        <i class="fa fa-calendar"></i>
                    </button>
                </span>
                <ul ng-class="{ 'parsley-error-list': form.endDate.$dirty && form.endDate.$invalid }" ng-show="form.endDate.$dirty && form.endDate.$invalid">
                    <li class="required" ng-show="form.endDate.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    <li class="required" ng-show="form.endDate.$error.parse">{{'GenericFormFields.EndDate.Messages.Invalid' | translate }}</li>
                </ul>
            </p>
        </div>
        <div class="col-md-4">
            <span class="time-picker with-date-picker" ng-if="(interval.name === 'MINUTELY' || interval.name === 'HOURLY' || interval.name === 'ALL')">
                <div uib-timepicker ng-model="dateHolder.endTime" hour-step="hstep" minute-step="mstep"
                            show-meridian="false" readonly-input="true" mousewheel="false"
                            ng-change="updateEndDateTime(dateHolder.endTime)"></div>
            </span>
        </div>
    </div>

    <!-- Daily Special Date Selection -->
    <div class="form-group" ng-if="interval.name === 'DAILY_SPECIAL'">
        <label for="startDate" class="col-md-3 text-left">{{ 'PartnerInfo.Reporting.Date' | translate }}</label>
        <div class="col-md-3">
            <p class="input-group datepicker-field">
                <input type="text" class="form-control input-sm" id="startDate" name="startDate"
                       uib-datepicker-popup="{{dateFormat}}" ng-model="dateHolder.startDate"
                       is-open="startDatePicker.opened"
                       datepicker-options="dateOptions" ng-required="true"
                       ng-change="updateStartDate(dateHolder.startDate)"/>
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default input-sm"
                            ng-click="openStartDatePicker($event)"><i
                            class="fa fa-calendar"></i></button>
                </span>
                <ul ng-class="{ 'parsley-error-list': form.startDate.$dirty && form.startDate.$invalid }" ng-show="form.startDate.$dirty && form.startDate.$invalid">
                    <li class="required" ng-show="form.startDate.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    <li class="required" ng-show="form.startDate.$error.parse">{{ 'GenericFormFields.StartDate.Messages.Invalid' | translate }}</li>
                </ul>
            </p>
        </div>
    </div>

    <!-- Monthly Special Date Selection -->
    <div class="form-group" ng-if="interval.name === 'MONTHLY_SPECIAL' || interval.name === 'MONTHLY2_SPECIAL'">
        <label for="startDate" class="col-md-3 text-left">{{ 'PartnerInfo.Reporting.ReportingWindow' | translate }}</label>
        <div class="col-md-3">
            <p class="input-group datepicker-field">
                <input type="text" class="form-control input-sm" id="startDate" name="startDate"
                       uib-datepicker-popup="{{'MMMM, y'}}" ng-model="dateHolder.startDate"
                       is-open="startDatePicker.opened"
                       datepicker-options="{ formatYear: 'yy', startingDay: 1, showWeeks: false, minMode: 'month' }"
                       datepicker-mode="'month'"
                       ng-required="true"
                       ng-change="updateStartDate(dateHolder.startDate)"/>
                <span class="input-group-btn">
                    <button type="button" class="btn btn-default input-sm"
                            ng-click="openStartDatePicker($event)"><i
                            class="fa fa-calendar"></i></button>
                </span>
                <ul ng-class="{ 'parsley-error-list': form.startDate.$dirty && form.startDate.$invalid }" ng-show="form.startDate.$dirty && form.startDate.$invalid">
                    <li class="required" ng-show="form.startDate.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    <li class="required" ng-show="form.startDate.$error.parse">{{ 'GenericFormFields.StartDate.Messages.Invalid' | translate }}</li>
                </ul>
            </p>
        </div>
    </div>

    <div class="form-group">
        <label class="col-md-3">{{ 'PartnerInfo.Reporting.Format' | translate }}</label>
        <div class="col-md-3">
            <select id="formatPentaho" name="formatPentaho" class="form-control parsley-validated"
                    ng-model="formatPentaho"
                    ng-options="opt as opt.name for opt in FORMATS_PENTAHO">
            </select>
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-7 col-md-push-3">
            <button type="submit" class="btn btn-danger" ng-disabled="form.$invalid"
                    ng-click="export(reportCategory, interval, formatPentaho, dateHolder, permanentParams, additionalParams);"
                    report-button-indicator
                    ng-disabled="!AuthorizationService.canPrmReportsOnDemandRead()">
                {{ (formatPentaho.inline ? 'CommonLabels.View' : 'CommonLabels.Download') | translate }}
                <i class="fa fa-spinner fa-spin" ng-if="showSpinner"></i>
            </button>

            <button type="button" class="btn btn-secondary" ng-disabled="form.$invalid"
                    uib-tooltip="{{ 'PartnerInfo.Reporting.ReportTemplate.SaveAsTemplateTooltip' | translate }}" tooltip-placement="top" tooltip-animation="false" tooltip-trigger="'mouseenter'" tooltip-append-to-body="true"
                    ng-click="saveReportTemplate(reportCategory, interval, formatPentaho, dateHolder, permanentParams, additionalParams);"
                    ng-disabled="!AuthorizationService.canPrmReportsOnDemandRead()">
                {{ 'PartnerInfo.Reporting.ReportTemplate.SaveAsTemplate' | translate }}
            </button>
        </div>
    </div>

</form>