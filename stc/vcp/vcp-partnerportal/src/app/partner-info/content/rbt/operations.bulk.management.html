<div class="portlet-header">
    <h4 class="portlet-title">
        {{ 'CommonLabels.RBT' | translate }} / {{ 'PartnerInfo.Contents.RBT.BulkOperations.Title' | translate }} / {{ 'PartnerInfo.Contents.RBT.BulkOperations.Management.Title' | translate }}
    </h4>
</div>


<!--Show Filter / Hide Filter-->
<div class="portlet-body buttons-portlet-body">
    <div class="row">
        <div class="col-md-7 col-xs-4">
            <div class="pull-left">
                <div class="btn btn-secondary btn-sm pull-left"
                     title="{{ 'CommonMessages.FilterButtonTitle' | translate }}"
                     ng-model="filterFormLayer.isFilterFormOpen"
                     ng-init="filterFormLayer.isFilterFormOpen = false"
                     ng-click="filterFormLayer.isFilterFormOpen = !filterFormLayer.isFilterFormOpen">
                    <span ng-if="!filterFormLayer.isFilterFormOpen">{{ 'CommonLabels.ShowFilter' | translate }} <i class="fa fa-chevron-circle-right"></i></span>
                    <span ng-if="filterFormLayer.isFilterFormOpen">{{ 'CommonLabels.HideFilter' | translate }} <i class="fa fa-chevron-circle-down"></i></span>
                </div>
            </div>
        </div>

        <div class="col-md-5 col-xs-8">
            <div class="pull-right">
            </div>
        </div>
    </div>
</div>

<!--Filter Form-->
<div class="portlet-body">
    <div class="row">
        <div hidden-filter-form ng-model="filterFormLayer" class="col-sm-12 filter-form">

            <form id="filterForm" name="filterForm" method="post" enctype="multipart/form-data" class="form-horizontal parsley-form" novalidate>

                <div class="portlet portlet-boxed">

                    <div class="portlet-body">

                        <div class="col-lg-9 col-md-9 col-sm-12">

                            <!--Status Filter-->
                            <div class="form-group">
                                <label for="status" class="col-md-4 control-label text-right">{{ 'CommonLabels.State' | translate }}</label>
                                <div class="col-md-7">
                                    <select id="status" name="status" class="form-control"
                                            ng-model="dateFilter.status"
                                            ng-options="status as status for status in CMS_RBT_STATUS_TYPES">
                                        <option value="">{{ 'CommonLabels.All' | translate | uppercase}}</option>
                                    </select>
                                </div>
                            </div>

                            <!--Alias Filter-->
                            <div class="form-group">
                                <label for="alias" class="col-md-4 control-label text-right">{{ 'PartnerInfo.Contents.RBT.ContentMetadatas.Alias' | translate }}</label>
                                <div class="col-md-7">
                                    <input type="text" class="form-control input-sm" id="alias" name="alias"
                                           ng-model="dateFilter.alias" placeholder="{{ 'PartnerInfo.Contents.RBT.ContentMetadatas.AliasPlaceholder' | translate }}"/>
                                </div>
                            </div>

                        </div>

                        <div class="col-lg-3 col-md-3 col-sm-12">
                            <!--Search Button-->
                            <div class="form-group">
                                <label class="col-md-3 control-label text-right">&nbsp;</label>
                                <div class="col-md-7">
                                    <button class="btn btn-sm btn-secondary" ng-disabled="filterForm.$invalid"
                                            ng-click="throttledReloadTable();"><i class="fa fa-search"></i>
                                        {{'CommonLabels.Search' | translate }}
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>

            </form>

        </div>
    </div>
</div>

<!--Search With Name-->
<div class="portlet-body buttons-portlet-body" ng-show="contentMetadataList.showTable">
    <div class="row">

        <div class="col-md-8 col-sm-6 col-xs-8">
            <!--<span ng-if="selectedTone.name">
                <div class="modal-option-selection">
                    <span ng-if="selectedTone.alias" class="label label-warning">{{selectedTone.alias}} </span>
                    <span class="label label-info">{{selectedTone.organizationName}} </span>
                    <span class="label label-success">{{selectedTone.name}}&nbsp;&nbsp;<a
                            href="javascript:;" ng-click="removeSelection();"><i
                            class="fa fa-times-circle"></i></a></span>
                </div>
            </span>
            <span ng-if="!selectedTone || !selectedTone.name">
                {{ 'CommonMessages.SelectTableRecord' | translate }}
            </span>-->
        </div>

        <div class="col-md-4 col-sm-6 col-xs-4">
            <form class="mainnav-form">
                <input type="text" class="form-control input-sm pull-right mainnav-search-query"
                       ng-model="filterText" ng-change="filterTable(filterText, ['name'])"
                       placeholder="{{ 'PartnerInfo.Contents.RBT.ContentMetadatas.SearchByToneTitle' | translate }}...">
                <button class="btn btn-sm mainnav-form-btn"><i class="fa fa-search"></i></button>
            </form>
        </div>
    </div>
</div>

<!-- Data Table -->
<div class="portlet-body" ng-show="contentMetadataList.showTable">
    <div class="row">
        <div class="col-sm-12">
            <div class="table-responsive">
                <table ng-table="contentMetadataList.tableParams" class="table table-striped table-bordered"
                       template-pagination="ngTableCustomPager.html"
                       export-csv="csv" export-xls="xls"
                       export-options="exportOptions">
                    <tr ng-repeat="data in $data track by $index" class="hidden-link-cell-row"
                        ng-class="{ 'row-selected': selectedTone.id === data.id }"
                        ng-click="toneSelected(data)"
                        ng-class="{ 'row-selected': data.selected }"
                        uib-popover-template="'partner-info/content/operations.bulk.management.confirmation.popover.html'"
                        popover-placement="auto" popover-animation="false" popover-trigger="'mouseenter'" popover-append-to-body="true"
                        popover-title="[Tone Title = {{data.name}}]" popover-tmpl-tone="data">
                        <td align="center" data-title="'PartnerInfo.Contents.RBT.ContentMetadatas.Alias' | translate" sortable="'alias'">{{data.alias}}</td>
                        <td align="center" class="wrap width-100" data-title="'PartnerInfo.Contents.RBT.ContentMetadatas.Tones.Name' | translate" sortable="'name'">{{data.name}}</td>
                        <td align="center" class="wrap width-150" data-title="'CommonLabels.State' | translate">{{data.status}} <span ng-if="data.status == 'REJECTED' && data.rejectReason" class="fa fa-question-circle"
                                                                                                               uib-tooltip="{{data.rejectReason}}"
                                                                                                               tooltip-placement="top"
                                                                                                               style="margin-left: 6px; cursor: pointer;"></span></td>
                        <td align="center" data-title="'PartnerInfo.Contents.RBT.ChargingDetails.Price' | translate">{{data.offers[0].price | PriceFormatterFilter}}</td>
                        <td align="center" data-title="'PartnerInfo.Contents.RBT.ChargingDetails.ChargingPeriod' | translate">{{data.offers[0].chargingPeriodDetail | ChargingDetailsFilter}}</td>
                        <td align="center" class="wrap width-80" data-title="'GenericFormFields.EndDate.Label' | translate">{{data.expireDate | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET}}</td>
                        <td align="center" data-title="'PartnerInfo.Contents.RBT.ContentMetadatas.Subscriptions' | translate">{{data.totalSubscriptionCount}}</td>
                        <td align="center" data-title="'PartnerInfo.Contents.RBT.ContentMetadatas.ToneWAVEAudio' | translate">
                            <button ng-if="data.toneFileId"
                                    ng-click="playAudio($index, data.toneFileId)"
                                    class="btn btn-xs {{audio.canDisplayButton($index, data.toneFileId, 'stop') ? 'btn-danger' : 'btn-secondary btn-inverse'}}"
                                    title="{{ audio.getLabel($index,data.toneFileId) | translate }}">
                                <i class="fa fa-play-circle"
                                   ng-if="audio.canDisplayButton($index, data.toneFileId, 'play')"></i>
                                <i class="fa fa-spinner fa-spin"
                                   ng-if="audio.canDisplayButton($index, data.toneFileId, 'spinner')"></i>
                                <i class="fa fa-stop-circle"
                                   ng-if="audio.canDisplayButton($index, data.toneFileId, 'stop')"></i>
                            </button>
                        </td>
                        <td align="center" data-title="'PartnerInfo.Contents.RBT.ContentMetadatas.ToneMP3Audio' | translate">
                            <button ng-if="data.mp3FileId"
                                    ng-click="playAudio($index, data.mp3FileId)"
                                    class="btn btn-xs {{audio.canDisplayButton($index, data.mp3FileId, 'stop') ? 'btn-danger' : 'btn-secondary btn-inverse'}}"
                                    title="{{ audio.getLabel($index,data.mp3FileId) | translate }}">
                                <i class="fa fa-play-circle"
                                   ng-if="audio.canDisplayButton($index, data.mp3FileId, 'play')"></i>
                                <i class="fa fa-spinner fa-spin"
                                   ng-if="audio.canDisplayButton($index, data.mp3FileId, 'spinner')"></i>
                                <i class="fa fa-stop-circle"
                                   ng-if="audio.canDisplayButton($index, data.mp3FileId, 'stop')"></i>
                            </button>
                        </td>
                        <td align="center" data-title="'CommonLabels.Actions' | translate" class="action-column">
                            <button ui-sref="partner-info.operations.rbt.contentmetadatas.tones.update({ id : data.id })"
                                    class="btn btn-xs btn-secondary"
                                    title="{{ AuthorizationService.canRBTToneUpdate() ? ('CommonLabels.Update' | translate) : ('CommonLabels.View' | translate) }}">
                                <i class="fa fa-edit" ng-if="AuthorizationService.canRBTToneUpdate(data.status)"></i>
                                <i class="fa fa-square-o" ng-if="!AuthorizationService.canRBTToneUpdate(data.status)"></i>
                            </button>
                        </td>
                    </tr>
                    <tr ng-if="!$data || $data.length === 0">
                        <td colspan="13" class="text-center">{{ 'CommonMessages.EmptyTable' | translate }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Tone Detail Popover. Please use "data" for binding. -->
<script type="text/ng-template" id="partner-info/content/operations.bulk.management.confirmation.popover.html">
    <div>
        <div>
            <strong>{{ 'PartnerInfo.Contents.RBT.ContentMetadatas.Alias' | translate }}:</strong> {{data.alias}} <br />
            <strong>{{ 'PartnerInfo.Contents.RBT.ContentMetadatas.Tones.Id' | translate }}:</strong> {{data.id}} <br />
            <!--<strong>{{ 'Subsystems.ContentManagement.Operations.RBT.ContentMetadatas.Tones.Name' | translate }}:</strong> {{data.name}}<br />-->
            <strong>{{ 'CommonLabels.Organization' | translate }}:</strong> {{data.organizationName}}<br />
            <strong>{{ 'CommonLabels.State' | translate }}:</strong> {{data.status}}<br />
            <div  ng-if="data.status === 'REJECTED' && data.rejectReason"><strong>{{ 'PartnerInfo.Contents.RBT.ContentMetadatas.Tones.RejectReason' | translate }}:</strong> {{data.rejectReason}}<br /></div>
            <div>
                <strong>{{ 'CommonLabels.CreatedOn' | translate }}:</strong> {{data.dateCreated | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET}} -
                <strong>{{ 'CommonLabels.LastUpdateTime' | translate }}:</strong> {{data.dateCreated | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET}}<br /></div>
            <div>
                <strong>{{ 'GenericFormFields.StartDate.Label' | translate }}:</strong> {{data.launchDate | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET}} -
                <strong>{{ 'GenericFormFields.EndDate.Label' | translate }}:</strong> {{data.expireDate | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET}}
            </div>
            <strong>{{ 'PartnerInfo.Contents.RBT.ChargingDetails.Price' | translate }}:</strong> {{data.offers[0].price | PriceFormatterFilter}} -
            <strong>{{ 'PartnerInfo.Contents.RBT.ChargingDetails.ChargingPeriod' | translate }}:</strong> {{data.offers[0].chargingPeriodDetail | ChargingDetailsFilter}}<br />
        </div>
    </div>
</script>
