<div class="col-md-12">
    <div class="portlet portlet-default">

        <div class="portlet-header">
            <h4 class="portlet-title" active-loading-indicator>
                {{ 'PartnerInfo.Users.Title' | translate }}
            </h4>
        </div>

        <div class="row">
            <div class="row panel-body">

                <div class="col-sm-12 col-md-12">
                    <form class="form-horizontal parsley-form registration-form" novalidate id="form" name="form" method="post" enctype="multipart/form-data" autocomplete="off">
                        <fieldset id="formFieldset">

                        <div class="form-group">
                            <label class="col-md-3">{{ 'PartnerInfo.Users.Form.UserName.Label' | translate }}</label>
                            <div class="col-md-7" ng-if="!userAccount.id">
                                <div class="username-group" style="width: 100%;">
                                    <input id="username" name="username" type="text" class="form-control"
                                           uib-popover="{{ 'PartnerInfo.Users.UserNameTooltip' | translate }}" popover-placement="top-left" popover-animation="false" popover-trigger="'focus'" popover-append-to-body="true"
                                           ng-model="userAccount.userName"
                                           ng-maxlength="50" maxlength="50" autocomplete="off"
                                           ng-required="true"
                                           ng-disabled="!AuthorizationService.canPrmUserAccountCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.username.$dirty && form.username.$invalid }"
                                        ng-show="form.username.$dirty && form.username.$invalid">
                                        <li class="required" ng-show="form.username.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.username.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 50} }}</li>
                                    </ul>
                                    <div class="username-group-addon"><div class="input-group-addon">@</div></div>
                                    <input id="companyShortName" name="companyShortName" type="text" class="form-control"
                                           ng-value="getOrganizationName()"
                                           ng-disabled="true"/>
                                </div>
                            </div>
                            <div class="col-md-7" ng-if="userAccount.id">
                                <input id="username" name="username" type="text" class="form-control"
                                       ng-model="userAccount.userName"
                                       ng-disabled="true"/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'PartnerInfo.Users.Form.UserId.Label' | translate }}</label>
                            <div class="col-md-7">
                                <input id="id" name="id" type="text" class="form-control" ng-model="userAccount.id" ng-disabled="true"/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.CreatedOn' | translate }}</label>
                            <div class="col-md-7">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.CreatedOn | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET" disabled/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.CreatedBy' | translate }}</label>
                            <div class="col-md-7">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.CreatedBy" disabled/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.LastUpdatedOn' | translate }}</label>
                            <div class="col-md-7">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.LastUpdatedOn | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET" disabled/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.LastUpdatedBy' | translate }}</label>
                            <div class="col-md-7">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.LastUpdatedBy" disabled/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3">{{ 'PartnerInfo.Users.Form.Password.Label' | translate }}</label>
                            <div class="col-md-4">
                                <input id="password" name="password" type="password" class="form-control"
                                       uib-popover="{{ 'CommonMessages.PasswordTooltip' | translate }}" popover-placement="top-left" popover-animation="false" popover-trigger="'focus'" popover-append-to-body="true"
                                       ng-model="userAccount.password"
                                       ng-change="userAccount.confirmpassword = null;"
                                       ng-pattern="form.password.$dirty ? $root.Validators.UserPassword : false"
                                       ng-required="true" ng-minlength="8" maxlength="50" ng-maxlength="50"
                                       ng-disabled="userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate()"/>
                                <ul ng-class="{ 'parsley-error-list': form.password.$dirty && form.password.$invalid }" ng-show="form.password.$dirty && form.password.$invalid">
                                    <li class="required" ng-show="!form.password.$error.minlength && form.password.$error.pattern">{{ 'CommonMessages.PasswordDoesNotMeetRequirements' | translate }}</li>
                                    <li class="required" ng-show="form.password.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                    <li class="required" ng-show="form.password.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 8 } }}</li>
                                    <li class="required" ng-show="form.password.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{ max_length: 50 } }}</li>
                                </ul>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3">{{ 'PartnerInfo.Users.Form.ConfirmPassword.Label' | translate }}</label>
                            <div class="col-md-4">
                                <input id="confirmpassword" name="confirmpassword" type="password" class="form-control"
                                       ng-model="userAccount.confirmpassword"
                                       partnerportal-password-verify="userAccount.password"
                                       ng-required="true" ng-minlength="8" maxlength="50" ng-maxlength="50"
                                       ng-disabled="userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate()"/>
                                <ul ng-class="{ 'parsley-error-list': form.confirmpassword.$dirty && form.confirmpassword.$invalid }"
                                    ng-show="form.confirmpassword.$dirty && form.confirmpassword.$invalid">
                                    <li class="required" ng-show="form.confirmpassword.$error.passwordVerify">{{ 'CommonMessages.PasswordError' | translate }}</li>
                                    <li class="required" ng-show="form.confirmpassword.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                    <li class="required" ng-show="form.confirmpassword.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 8 } }}</li>
                                    <li class="required" ng-show="form.confirmpassword.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{ max_length: 50 } }}</li>
                                </ul>
                            </div>
                        </div>

                        <div class="form-group" ng-if="SessionService.isUserAdmin()">
                            <label class="col-md-3">{{ 'PartnerInfo.Users.Form.State.Label' | translate }}</label>
                            <div class="col-md-4">
                                <select id="state" name="state" class="form-control parsley-validated"
                                        ng-model="userAccount.state"
                                        ng-options="state.value as (state.label | translate | uppercase) for state in STATUS_TYPES"
                                        ng-disabled="userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate()">
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="startDate" class="col-md-3 text-left">{{ 'GenericFormFields.StartDate.Label' | translate }}</label>
                            <div class="col-md-3">
                                <p class="input-group datepicker-field">
                                    <input id="startDate" name="startDate" type="text" class="form-control input-sm"
                                           uib-datepicker-popup="{{dateFormat}}" ng-model="dateHolder.startDate"
                                           is-open="startDatePicker.opened"
                                           datepicker-options="dateOptions"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <span class="input-group-btn">
                                <button type="button" class="btn btn-default input-sm" ng-click="openStartDatePicker($event)"
                                        ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())">
                                    <i class="fa fa-calendar"></i>
                                </button>
                            </span>
                                <ul ng-class="{ 'parsley-error-list': form.startDate.$dirty && form.startDate.$invalid }" ng-show="form.startDate.$dirty && form.startDate.$invalid">
                                    <li class="required" ng-show="form.startDate.$error.parse">{{'GenericFormFields.StartDate.Messages.Invalid' | translate }}</li>
                                    <li class="required" ng-show="form.startDate.$error.maxDateExceeded">{{'GenericFormFields.StartDate.Messages.MaxDateExceeded' | translate }}</li>
                                </ul>
                                </p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="endDate" class="col-md-3 text-left">{{ 'GenericFormFields.EndDate.Label' | translate }}</label>
                            <div class="col-md-3">
                                <p class="input-group datepicker-field">
                                    <input id="endDate" name="endDate" type="text" class="form-control input-sm"
                                           uib-datepicker-popup="{{dateFormat}}" ng-model="dateHolder.endDate"
                                           is-open="endDatePicker.opened"
                                           ng-required="true"
                                           datepicker-options="dateOptions"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <span class="input-group-btn">
                                <button type="button" class="btn btn-default input-sm" ng-click="openEndDatePicker($event)"
                                        ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())">
                                    <i class="fa fa-calendar"></i>
                                </button>
                            </span>
                                <ul ng-class="{ 'parsley-error-list': form.endDate.$dirty && form.endDate.$invalid }" ng-show="form.endDate.$dirty && form.endDate.$invalid">
                                    <li class="required" ng-show="form.endDate.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                    <li class="required" ng-show="form.endDate.$error.parse">{{'GenericFormFields.EndDate.Messages.Invalid' | translate }}</li>
                                    <li class="required" ng-show="form.endDate.$error.minDateExceeded">{{'GenericFormFields.EndDate.Messages.MinDateExceeded' | translate }}</li>
                                </ul>
                                </p>
                            </div>
                        </div>

                        <div class="form-group" ng-if="SessionService.isUserAdmin()">
                            <label class="col-md-3">{{ 'PartnerInfo.Users.Form.IsAdmin.Label' | translate }}</label>
                            <div class="col-md-4">
                                <div class="btn-group">
                                    <button class="btn {{userAccount.isAdminUser?'btn-primary active':'btn-default'}} btn-sm"
                                            ng-disabled="userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate()"
                                            ng-model="userAccount.isAdminUser" uib-btn-radio="true">{{ 'CommonLabels.Yes' | translate }}</button>
                                    <button class="btn {{!userAccount.isAdminUser?'btn-primary active':'btn-default'}} btn-sm"
                                            ng-disabled="userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate()"
                                            ng-model="userAccount.isAdminUser" uib-btn-radio="false">{{ 'CommonLabels.No' | translate }}</button>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-10">
                                <h5 class="portlet-title">
                                    {{ 'PartnerInfo.Users.Form.Details.Title' | translate }}
                                </h5>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label for="name" class="col-md-3">{{ 'PartnerInfo.Users.Form.Details.Name' | translate }}</label>
                                <div class="col-md-7">
                                    <input id="name" name="name" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.Name"
                                           maxlength="50" ng-maxlength="50"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <ul ng-class="{ 'parsley-error-list': form.name.$dirty && form.name.$invalid }" ng-show="form.name.$dirty && form.name.$invalid">
                                        <li class="required" ng-show="form.name.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 50} }}</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="surname" class="col-md-3">{{ 'PartnerInfo.Users.Form.Details.Surname' | translate }}</label>
                                <div class="col-md-7">
                                    <input id="surname" name="surname" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.Surname"
                                           maxlength="50" ng-maxlength="50"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <ul ng-class="{ 'parsley-error-list': form.surname.$dirty && form.surname.$invalid }" ng-show="form.surname.$dirty && form.surname.$invalid">
                                        <li class="required" ng-show="form.surname.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 50} }}</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="MobilePhone" class="col-md-3">{{ 'PartnerInfo.Users.Form.Details.MobilePhone' | translate }}</label>
                                <div class="col-md-7">
                                    <input id="MobilePhone" name="MobilePhone" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.MobilePhone"
                                           ng-required="true"
                                           ng-minlength="5" maxlength="20" ng-maxlength="20"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <ul ng-class="{ 'parsley-error-list': form.MobilePhone.$dirty && form.MobilePhone.$invalid }" ng-show="form.MobilePhone.$dirty && form.MobilePhone.$invalid">
                                        <li class="required" ng-show="form.MobilePhone.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.MobilePhone.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 5 } }}</li>
                                        <li class="required" ng-show="form.MobilePhone.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 20} }}</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="fixedPhone" class="col-md-3">{{ 'PartnerInfo.Users.Form.Details.FixedPhone' | translate }}</label>
                                <div class="col-md-7">
                                    <input id="fixedPhone" name="fixedPhone" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.FixedPhone"
                                           ng-minlength="5" maxlength="20" ng-maxlength="20"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <ul ng-class="{ 'parsley-error-list': form.fixedPhone.$dirty && form.fixedPhone.$invalid }" ng-show="form.fixedPhone.$dirty && form.fixedPhone.$invalid">
                                        <li class="required" ng-show="form.fixedPhone.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 5 } }}</li>
                                        <li class="required" ng-show="form.fixedPhone.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 20} }}</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="email" class="col-md-3">{{ 'PartnerInfo.Users.Form.Details.Email' | translate }}</label>
                                <div class="col-md-7">
                                    <input id="email" name="email" type="email" class="form-control"
                                           ng-model="userAccount.userProfile.Email"
                                           ng-required="true"
                                           maxlength="100" ng-maxlength="100"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <ul ng-class="{ 'parsley-error-list': form.email.$dirty && form.email.$invalid }"
                                        ng-show="form.email.$dirty && form.email.$invalid">
                                        <li class="required" ng-show="form.email.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.email.$error.email">{{ 'CommonMessages.InvalidEmail' | translate }}</li>
                                        <li class="required" ng-show="form.email.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 100} }}</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="supervisorEmail" class="col-md-3">{{ 'PartnerInfo.Users.Form.Details.SupervisorEmail' | translate }}</label>
                                <div class="col-md-7">
                                    <input id="supervisorEmail" name="supervisorEmail" type="email" class="form-control"
                                           ng-model="userAccount.userProfile.SupervisorEmail"
                                           ng-required="true"
                                           maxlength="100" ng-maxlength="100"
                                           ng-disabled="(userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate())"/>
                                    <ul ng-class="{ 'parsley-error-list': form.supervisorEmail.$dirty && form.supervisorEmail.$invalid }"
                                        ng-show="form.supervisorEmail.$dirty && form.supervisorEmail.$invalid">
                                        <li class="required" ng-show="form.supervisorEmail.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.supervisorEmail.$error.email">{{ 'CommonMessages.InvalidEmail' | translate }}</li>
                                        <li class="required" ng-show="form.supervisorEmail.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 100} }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-md-7 col-md-push-3">
                                <button type="submit" class="btn btn-danger"
                                        ng-disabled="form.$invalid || (userAccount.id ? !AuthorizationService.canPrmUserAccountUpdate() : !AuthorizationService.canPrmUserAccountCreate()) || isNotChanged()"
                                        ng-click="save(userAccount);">
                                    {{ 'CommonLabels.Save' | translate }}
                                </button>
                                <button type="reset" class="btn btn-default" ng-click="cancel();">
                                    {{ 'CommonLabels.Cancel' | translate }}
                                </button>
                            </div>
                        </div>

                        </fieldset>
                    </form>
                </div>

            </div>
        </div>

    </div>
</div>
