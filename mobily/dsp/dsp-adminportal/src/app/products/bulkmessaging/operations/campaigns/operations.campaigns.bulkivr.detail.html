<div class="portlet-body" ng-show="!isBulkIvrUser">
    <h5>
        <span class="col-md-12 text-center alert alert-warning">{{ 'CommonMessages.NotBulkIVRUser' | translate }}</span>
    </h5>
</div>

<div class="portlet-body" ng-show="isBulkIvrUser">

    <form class="form-horizontal parsley-form" novalidate id="campaignForm" name="form" method="post" enctype="multipart/form-data">

        <div class="form-group">
            <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.CampaignName' | translate }}</label>
            <div class="col-md-7">
                <input name="campaignName" type="text" class="form-control" ng-model="campaign.campaignName"
                       ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                       ng-required="true" maxlength="512" ng-maxlength="512"/>
                <ul ng-class="{ 'parsley-error-list': form.campaignName.$dirty && form.campaignName.$invalid }"
                    ng-show="form.campaignName.$dirty && form.campaignName.$invalid">
                    <li class="required" ng-show="form.campaignName.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    <li class="required" ng-show="form.campaignName.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{ max_length: 512 } }}</li>
                </ul>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.CampaignStartDateTime' | translate }}</label>
            <div class="col-md-3">
                <p class="input-group datepicker-field">
                    <input type="text" class="form-control input-sm" id="startDate" name="startDate"
                           uib-datepicker-popup="{{dateFormat}}" ng-model="dateHolder.startDate"
                           ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                           is-open="startDatePicker.opened" close-text="Close"
                           datepicker-options="dateOptions" ng-required="true"
                           ng-change="updateStartDate(dateHolder.startDate)"/>
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default input-sm"
                                ng-click="openStartDatePicker($event)"><i
                                class="fa fa-calendar"></i></button>
                    </span>
                    <ul ng-class="{ 'parsley-error-list': form.startDate.$dirty && form.startDate.$invalid }"
                        ng-show="form.startDate.$dirty && form.startDate.$invalid">
                        <li class="required" ng-show="form.startDate.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                        <li class="required" ng-show="form.startDate.$error.date">{{ 'GenericFormFields.StartDate.Messages.Invalid' | translate }}</li>
                    </ul>
                </p>
            </div>
            <div class="col-md-4 row">
                <span class="time-picker with-date-picker">
                    <div uib-timepicker ng-model="dateHolder.startTime" hour-step="hstep" minute-step="mstep"
                         show-meridian="false" readonly-input="true" mousewheel="false" ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                         ng-change="updateStartDateTime(dateHolder.startTime)"></div>
                </span>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-10">
                <div class="divider"></div>
            </div>
        </div>

        <div class="settings-expander">
            <a id="extra-settings-expander" class="link" href="javascript:;" ng-click="showExtraSettings = !showExtraSettings;">
                {{ (showExtraSettings ? 'CommonLabels.HideExtraSettings' : 'CommonLabels.ShowExtraSettings') | translate }}
            </a>
        </div>

        <!-- Extra form fields -->
        <span ng-if="showExtraSettings">
            <div class="form-group">
                <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.ForceExpiryDate' | translate }}</label>
                <div class="col-md-7">
                    <div class="btn-group">
                        <button type="button" class="btn {{campaign.forceExpiryDate ?'btn-primary active':'btn-default'}} btn-sm"
                                ng-model="campaign.forceExpiryDate" ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()" uib-btn-radio="true">{{ 'CommonLabels.Yes' | translate }}</button>
                        <button type="button" class="btn {{!campaign.forceExpiryDate ?'btn-primary active':'btn-default'}} btn-sm"
                                ng-model="campaign.forceExpiryDate" ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()" uib-btn-radio="false">{{ 'CommonLabels.No' | translate }}</button>
                    </div>
                </div>
            </div>

            <div class="form-group" ng-if="campaign.forceExpiryDate">
                <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.CampaignExpiryDateTime' | translate }}</label>
                <div class="col-md-3">
                    <p class="input-group datepicker-field">
                        <input type="text" class="form-control input-sm" id="endDate" name="endDate"
                               uib-datepicker-popup="{{dateFormat}}" ng-model="dateHolder.endDate"
                               ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                               is-open="endDatePicker.opened" close-text="Close"
                               datepicker-options="dateOptions" ng-required="true"
                               ng-change="updateEndDate(dateHolder.endDate)"/>
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default input-sm"
                                    ng-click="openEndDatePicker($event)"><i
                                    class="fa fa-calendar"></i></button>
                        </span>
                        <ul ng-class="{ 'parsley-error-list': form.endDate.$dirty && form.endDate.$invalid }"
                            ng-show="form.endDate.$dirty && form.endDate.$invalid">
                            <li class="required" ng-show="form.endDate.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                            <li class="required" ng-show="form.endDate.$error.date">{{ 'GenericFormFields.EndDate.Messages.Invalid' | translate }}</li>
                        </ul>
                    </p>
                </div>
                <div class="col-md-4 row">
                    <span class="time-picker with-date-picker">
                        <div uib-timepicker ng-model="dateHolder.endTime" hour-step="hstep" minute-step="mstep"
                             show-meridian="false" readonly-input="true" mousewheel="false" ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                             ng-change="updateEndDateTime(dateHolder.endTime)"></div>
                    </span>
                </div>
            </div>

            <!-- Screening Lists -->
            <div class="form-group" ng-if="blackListEnabled">
                <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.EnforceScreening' | translate}}</label>
                <div class="col-md-7">
                    <div class="btn-group">
                        <button class="btn {{bulkIVRPolicyProfile.isScreeningListsEnforced?'btn-primary active':'btn-default'}} btn-sm"
                                ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                                ng-model="bulkIVRPolicyProfile.isScreeningListsEnforced" uib-btn-radio="true">{{ 'CommonLabels.Yes' | translate }}</button>
                        <button class="btn {{!bulkIVRPolicyProfile.isScreeningListsEnforced?'btn-primary active':'btn-default'}} btn-sm"
                                ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                                ng-model="bulkIVRPolicyProfile.isScreeningListsEnforced" uib-btn-radio="false">{{ 'CommonLabels.No' | translate }}</button>
                    </div>
                </div>
            </div>

            <div class="form-group" ng-if="blackListEnabled && bulkIVRPolicyProfile.isScreeningListsEnforced">
                <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.ScreeningLists' | translate}}</label>
                <div class="col-md-7">
                    <div ng-if="campaign.campaignBlackLists.length" class="row col-md-9">
                        <div ng-repeat="campaignBlackList in campaign.campaignBlackLists">
                            <span class="label label-default selected-item-label">
                                {{ campaignBlackList.name | limitTo:40 }}{{ campaignBlackList.name.length > 40 ? '...' : '' }}
                            </span>&nbsp;
                            <a ng-click="removeBlackList(campaign, campaignBlackList)" style="cursor: pointer;text-decoration: none;">
                                <span class="label label-danger" ng-if="AuthorizationService.canBmsOperationsCampaignCreate()"><i class="fa fa-times"></i></span>
                            </a>
                        </div>
                    </div>
                    <button class="btn btn-default col-md-3"
                            ng-class="{ 'pull-right': bulkIVRPolicyProfile.ScreeningLists.length }"
                            ng-click="addBlackList(campaign, campaign.campaignBlackLists)"
                            ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()">{{ 'CommonLabels.Add' | translate }}</button>
                </div>
            </div>

            <!-- Time Restrictions -->
            <div class="form-group">
                <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.EnforceTimeConstraints' | translate}}</label>
                <div class="col-md-7">
                    <div class="btn-group">
                        <button class="btn {{bulkIVRPolicyProfile.isTimeConstraintEnforced?'btn-primary active':'btn-default'}} btn-sm"
                                ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                                ng-model="bulkIVRPolicyProfile.isTimeConstraintEnforced" uib-btn-radio="true">{{ 'CommonLabels.Yes' | translate }}</button>
                        <button class="btn {{!bulkIVRPolicyProfile.isTimeConstraintEnforced?'btn-primary active':'btn-default'}} btn-sm"
                                ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                                ng-model="bulkIVRPolicyProfile.isTimeConstraintEnforced" uib-btn-radio="false">{{ 'CommonLabels.No' | translate }}</button>
                    </div>
                </div>
            </div>

            <div class="form-group" ng-if="bulkIVRPolicyProfile.isTimeConstraintEnforced">
                <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.TimeConstraints' | translate}}</label>
                <div class="col-md-7">
                    <div ng-if="bulkIVRPolicyProfile.TimeConstraints.length" class="row col-md-9">
                        <div ng-repeat="timeConstraint in bulkIVRPolicyProfile.TimeConstraints">
                            <span class="label label-default selected-item-label">
                                {{ timeConstraint.value | TimeConstraintViewFilter }}
                            </span>&nbsp;
                            <a ng-click="addUpdateTimeConstraint(campaign, bulkIVRPolicyProfile, timeConstraint)" style="cursor: pointer;text-decoration: none;">
                                <span class="label label-secondary" ng-if="AuthorizationService.canBmsOperationsCampaignCreate()"><i class="fa fa-edit"></i></span>
                            </a>
                            <a ng-click="removeTimeConstraint(bulkIVRPolicyProfile, timeConstraint)" style="cursor: pointer;text-decoration: none;">
                                <span class="label label-danger" ng-if="AuthorizationService.canBmsOperationsCampaignCreate()"><i class="fa fa-times"></i></span>
                            </a>
                        </div>
                    </div>
                    <button class="btn btn-default col-md-3"
                            ng-class="{ 'pull-right': bulkIVRPolicyProfile.TimeConstraints.length }"
                            ng-click="addUpdateTimeConstraint(campaign, bulkIVRPolicyProfile)"
                            ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()">{{ 'CommonLabels.Add' | translate }}</button>
                </div>
            </div>

            <!-- Disable Charging -->
            <div class="form-group" ng-if="isDisableChargingAllowed">
                <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.DisableCharging' | translate}}</label>
                <div class="col-md-7">
                    <div class="btn-group">
                        <button class="btn {{bulkIVRPolicyProfile.isDisableChargingAllowed?'btn-primary active':'btn-default'}} btn-sm"
                                ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                                ng-model="bulkIVRPolicyProfile.isDisableChargingAllowed" uib-btn-radio="true">{{ 'CommonLabels.Yes' | translate }}</button>
                        <button class="btn {{!bulkIVRPolicyProfile.isDisableChargingAllowed?'btn-primary active':'btn-default'}} btn-sm"
                                ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                                ng-model="bulkIVRPolicyProfile.isDisableChargingAllowed" uib-btn-radio="false">{{ 'CommonLabels.No' | translate }}</button>
                    </div>
                </div>
            </div>
        </span>

        <div class="form-group">
            <div class="col-md-10">
                <div class="divider"></div>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.From' | translate }}</label>
            <div class="col-md-7" ng-if="bulkIVRPolicyProfile.isAlphanumericSenderListRestricted">
                <select id="from" name="from" class="form-control parsley-validated" ng-model="campaign.from"
                        ng-required="true" ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                        ng-options="permissibleAlphanumericSender.value as permissibleAlphanumericSender.value for permissibleAlphanumericSender in bulkIVRPolicyProfile.PermissibleAlphanumericSenders">
                    <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                </select>
                <ul ng-class="{ 'parsley-error-list': form.from.$dirty && form.from.$invalid }" ng-show="form.from.$dirty && form.from.$invalid">
                    <li class="required" ng-show="form.from.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                </ul>
            </div>
            <div class="col-md-7" ng-if="!bulkIVRPolicyProfile.isAlphanumericSenderListRestricted">
                <input name="from" type="text" class="form-control" ng-value="bulkIVRPolicyProfile.SenderMsisdn" ng-disabled="true"/>
            </div>
        </div>

        <div class="form-group" ng-if="bulkIVRPolicyProfile.isOffNetDeliveryAllowed && bulkIVRPolicyProfile.isOffnetSenderListRestricted">
            <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.OffnetSenders' | translate}}</label>
            <div class="col-md-7">
                <div ng-show="campaign.offnetSenders.length" class="row col-md-9">
                    <div ng-repeat="n in campaign.offnetSenders">
                        <span class="label label-default selected-item-label">{{n.value}}</span>
                        <a ng-click="removeSelectedOffnetSender(campaign.offnetSenders, n)" style="cursor: pointer;"
                           ng-if="AuthorizationService.canBmsOperationsCampaignCreate()">
                            <span class="label label-danger"><i class="fa fa-times"></i></span>
                        </a>
                    </div>
                </div>
                <button class="btn btn-default col-md-3 ng-dirty" ng-click="openOffnetSenders(bulkIVRPolicyProfile, campaign)"
                        ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                        ng-class="{ 'pull-right': campaign.offnetSenders.length > 0 }">
                    {{ 'CommonLabels.AddTo' | translate }}
                </button>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.ListType' | translate }}</label>
            <div class="col-md-7">
                <select id="listType" name="listType" class="form-control parsley-validated" ng-model="listType"
                        ng-required="true" ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                        ng-options="listType.key as (listType.textKey | translate | uppercase) for listType in BMS_DISTRIBUTION_LIST_TYPES">
                    <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                </select>
                <ul ng-class="{ 'parsley-error-list': form.listType.$dirty && form.listType.$invalid }" ng-show="form.listType.$dirty && form.listType.$invalid">
                    <li class="required" ng-show="form.listType.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                </ul>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.Fields.To' | translate }}</label>
            <div class="col-md-7">
                <select id="to" name="to" class="form-control parsley-validated" ng-model="campaign.to"
                        ng-required="true" ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                        ng-options="distributionList.id as (distributionList.name + ' (' + distributionList.listSize + ')') for distributionList in (distributionListArray | DistributionListByListTypeFilter:listType)">
                    <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                </select>
                <ul ng-class="{ 'parsley-error-list': form.to.$dirty && form.to.$invalid }" ng-show="form.to.$dirty && form.to.$invalid">
                    <li class="required" ng-show="form.to.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                </ul>
            </div>
        </div>

        <!-- Announcement -->
        <div class="form-group">
            <label class="col-md-3">{{ 'Products.BulkMessaging.Operations.Campaigns.AnnouncementFiles' | translate }}</label>
            <div class="col-md-7">
                <div ng-if="campaign.announcementFileList.length" class="row col-md-9">
                    <div ng-repeat="announcementFile in campaign.announcementFileList">
                        <a ng-click="playStopAudio(announcementFile.file.lastModified);" style="cursor: pointer;text-decoration: none;color: #333333;"
                           ng-if="AuthorizationService.canBmsOperationsCampaignRead()">
                            <i class="fa {{ isPlaying(announcementFile.file.lastModified) ? 'fa-pause-circle' : 'fa-play-circle' }}"></i>
                        </a>&nbsp;
                        <span class="label label-default selected-item-label" style="cursor: text;text-overflow: ellipsis;width: 192px;overflow: hidden;white-space: nowrap;display: inline-block;vertical-align: middle;text-align: left;padding: 4px 4px 4px 10px;"
                              uib-tooltip="{{ getAnnouncementFileString(announcementFile) }}" tooltip-class="custom-class" tooltip-placement="top-left" tooltip-animation="false" tooltip-trigger="'mouseenter'" tooltip-append-to-body="true">
                            {{ getAnnouncementFileString(announcementFile) }}
                        </span>&nbsp;
                        <a ng-click="editAnnouncementFile(campaign, announcementFile)" style="cursor: pointer;text-decoration: none;"
                           ng-if="AuthorizationService.canBmsOperationsCampaignCreate()">
                            <span class="label label-secondary"><i class="fa fa-edit"></i></span>
                        </a>
                        <a ng-click="removeAnnouncementFile(campaign, announcementFile)" style="cursor: pointer;text-decoration: none;"
                           ng-if="AuthorizationService.canBmsOperationsCampaignCreate()">
                            <span class="label label-danger"><i class="fa fa-times"></i></span>
                        </a>
                        <audio id="{{announcementFile.file.lastModified}}" controls controlsList="nodownload" ngf-src="!announcementFile.file.$error && announcementFile.file" style="position: absolute;visibility: hidden;"></audio>
                    </div>
                </div>
                <button class="btn btn-default col-md-3"
                        ng-if="!campaign.announcementFileList || campaign.announcementFileList.length < 10"
                        ng-disabled="!AuthorizationService.canBmsOperationsCampaignCreate()"
                        ng-class="{ 'pull-right': campaign.announcementFileList.length > 0, 'ng-invalid-required': !campaign.announcementFileList.length }"
                        ng-click="addAnnouncementFile(campaign)">{{ 'CommonLabels.Add' | translate }}
                </button>
                <button class="btn btn-default col-md-3" ng-if="campaign.announcementFileList.length >= 10" ng-disabled="true" class="pull-right">{{ 'CommonLabels.Add' | translate }}</button>
                <div style="clear: both;">
                    <input name="announcementFileListLength" type="number" class="form-control"
                           ng-model="campaign.announcementFileList.length"
                           ng-init="campaign.announcementFileList = undefined"
                           ng-min="1" ng-required="true"
                           ng-show="false"/>
                    <ul ng-class="{ 'parsley-error-list': campaign.announcementFileList.length === 0 }"
                        ng-show="campaign.announcementFileList.length === 0">
                        <li class="required" ng-show="form.announcementFileListLength.$error.min">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- // Announcement -->

        <div class="form-group">
            <div class="col-md-6 col-md-push-3">
                <button type="submit" class="btn btn-danger"
                        ng-disabled="form.$invalid || !AuthorizationService.canBmsOperationsCampaignCreate()"
                        ng-click="start(campaign, dateHolder, bulkIVRPolicyProfile);">
                    {{ 'CommonLabels.Submit' | translate }}
                </button>
                <button class="btn btn-default" ng-click="cancel();">
                    {{ 'CommonLabels.Cancel' | translate }}
                </button>
            </div>
        </div>

    </form>

</div>
