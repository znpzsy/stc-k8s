<div class="portlet-header">
    <h4 class="portlet-title" active-loading-indicator>
        {{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.Title' | translate }}
    </h4>
</div>

<div class="portlet-body">

    <form class="form-horizontal parsley-form" novalidate id="form" name="form" method="post" enctype="multipart/form-data">
        <fieldset id="formFieldset">

        <div class="form-group" ng-if="businessType.profileId">
            <label class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.Id' | translate }}</label>
            <div class="col-md-7">
                <input type="text" class="form-control" ng-value="businessType.profileId" disabled/>
            </div>
        </div>

        <div class="form-group" ng-if="businessType.profileId">
            <label class="col-md-3">{{ 'CommonLabels.LastUpdateTime' | translate }}</label>
            <div class="col-md-7">
                <input type="text" class="form-control" ng-value="businessType.LastUpdateTime | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET" disabled/>
            </div>
        </div>

        <div class="form-group">
            <label for="Name" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.Name' | translate }}</label>
            <div class="col-md-7">
                <input id="Name" name="Name" type="text" class="form-control"
                       ng-model="businessType.Name"
                       ng-required="true" ng-maxlength="100" maxlength="100"
                       ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())"/>
                <ul ng-class="{ 'parsley-error-list': form.Name.$dirty && form.Name.$invalid }"
                    ng-show="form.Name.$dirty && form.Name.$invalid">
                    <li class="required" ng-show="form.Name.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    <li class="required" ng-show="form.Name.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 100} }}</li>
                </ul>
            </div>
        </div>

        <!-- TODO - Temporarily hidden -->
        <div class="form-group" ng-if="false">
            <label for="LegacyID" class="col-md-3">{{ 'CommonLabels.LegacyID' | translate }}</label>
            <div class="col-md-7">
                <input id="LegacyID" name="LegacyID" type="text" class="form-control"
                       ng-model="businessType.LegacyID"
                       ng-maxlength="100" maxlength="100"
                       ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())"/>
                <ul ng-class="{ 'parsley-error-list': form.LegacyID.$dirty && form.LegacyID.$invalid }"
                    ng-show="form.LegacyID.$dirty && form.LegacyID.$invalid">
                    <li class="required" ng-show="form.LegacyID.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 100} }}</li>
                </ul>
            </div>
        </div>

        <div class="form-group">
            <label for="Description" class="col-md-3">{{ 'CommonLabels.Description' | translate }}</label>
            <div class="col-md-7">
                <input id="Description" name="Description" type="text" class="form-control"
                       ng-model="businessType.Description"
                       ng-maxlength="255" maxlength="255"
                       ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())"/>
                <ul ng-class="{ 'parsley-error-list': form.Description.$dirty && form.Description.$invalid }"
                    ng-show="form.Description.$dirty && form.Description.$invalid">
                    <li class="required" ng-show="form.Description.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 255} }}</li>
                </ul>
            </div>
        </div>

        <div class="form-group">
            <label for="Status" class="col-md-3">{{ 'CommonLabels.State' | translate }}</label>
            <div class="col-md-4">
                <select id="Status" name="Status" class="form-control parsley-validated"
                        ng-model="businessType.Status"
                        ng-required="true"
                        ng-options="statusType as statusType for statusType in BUSINESS_MANAGEMENT_STATUS_TYPES"
                        ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                    <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                </select>
                <ul ng-class="{ 'parsley-error-list': form.Status.$dirty && form.Status.$invalid }"
                    ng-show="form.Status.$dirty && form.Status.$invalid">
                    <li class="required" ng-show="form.Status.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                </ul>
            </div>
        </div>

        <div class="form-group">
            <label for="ApplicantScope" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.ApplicantScope' | translate }}</label>
            <div class="col-md-4">
                <select id="ApplicantScope" name="ApplicantScope" class="form-control parsley-validated"
                        ng-model="businessType.ApplicantScope"
                        ng-required="true"
                        ng-options="applicantScope as applicantScope for applicantScope in BUSINESS_MANAGEMENT_APPLICANT_SCOPES"
                        ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                    <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                </select>
                <ul ng-class="{ 'parsley-error-list': form.ApplicantScope.$dirty && form.ApplicantScope.$invalid }"
                    ng-show="form.ApplicantScope.$dirty && form.ApplicantScope.$invalid">
                    <li class="required" ng-show="form.ApplicantScope.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                </ul>
            </div>
        </div>

        <div class="form-group" ng-if="businessType.ApplicantScope === 'PARTNER_TYPE'">
            <label class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.PartnerType' | translate }}</label>
            <div class="col-md-7">
                <div ng-if="selectedPartnerTypes.length > 0" class="row col-md-9">
                    <div ng-repeat="n in selectedPartnerTypes">
                        <span class="label label-default selected-item-label">{{n}}</span>
                        <a ng-click="removePartnerType(n)" style="cursor: pointer;"
                           ng-if="businessType.profileId ? AuthorizationService.canBizOperationsBusinessTypeUpdate() : AuthorizationService.canBizOperationsBusinessTypeCreate()">
                            <span class="label label-danger"><i class="fa fa-times"></i></span>
                        </a>
                    </div>
                </div>
                <button class="btn btn-default col-md-3 ng-dirty"
                        ng-disabled="businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate()"
                        ng-class="{ 'pull-right': selectedPartnerTypes.length > 0 }"
                        ng-click="showPartnerTypes()">
                    {{ 'CommonLabels.Choose' | translate }}
                </button>
            </div>
        </div>

        <div class="form-group">
            <label for="ChannelID" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.ChannelID' | translate }}</label>
            <div class="col-md-4">
                <select id="ChannelID" name="ChannelID" class="form-control parsley-validated"
                        ng-model="businessType.ChannelID"
                        ng-options="channel.profileId as channel.Name for channel in channels"
                        ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                    <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                </select>
                <ul ng-class="{ 'parsley-error-list': form.ChannelID.$dirty && form.ChannelID.$invalid }"
                    ng-show="form.ChannelID.$dirty && form.ChannelID.$invalid">
                </ul>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.ServiceTypes' | translate }}</label>
            <div class="col-md-7">
                <div ng-if="selectedServiceTypes.length > 0" class="row col-md-9">
                    <div ng-repeat="n in selectedServiceTypes">
                        <span class="label label-default selected-item-label">{{n.Name}}</span>
                        <a ng-click="removeServiceType(n)" style="cursor: pointer;"
                           ng-if="businessType.profileId ? AuthorizationService.canBizOperationsBusinessTypeUpdate() : AuthorizationService.canBizOperationsBusinessTypeCreate()">
                            <span class="label label-danger"><i class="fa fa-times"></i></span>
                        </a>
                    </div>
                </div>
                <button class="btn btn-default col-md-3 ng-dirty"
                        ng-disabled="businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate()"
                        ng-class="{ 'pull-right': selectedServiceTypes.length > 0 }"
                        ng-click="showServiceTypes()">
                    {{ 'CommonLabels.Add' | translate }}
                </button>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.SettlementTypes' | translate }}</label>
            <div class="col-md-7">
                <div ng-if="selectedSettlementTypes.length > 0" class="row col-md-9">
                    <div ng-repeat="n in selectedSettlementTypes">
                        <span class="label label-default selected-item-label">{{n.Name}}</span>
                        <a ng-click="removeSettlementType(n)" style="cursor: pointer;"
                           ng-if="businessType.profileId ? AuthorizationService.canBizOperationsBusinessTypeUpdate() : AuthorizationService.canBizOperationsBusinessTypeCreate()">
                            <span class="label label-danger"><i class="fa fa-times"></i></span>
                        </a>
                    </div>
                </div>
                <button class="btn btn-default col-md-3 ng-dirty"
                        ng-disabled="businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate()"
                        ng-class="{ 'pull-right': selectedSettlementTypes.length > 0 }"
                        ng-click="showSettlementTypes()">
                    {{ 'CommonLabels.Add' | translate }}
                </button>
            </div>
        </div>

        <div class="form-group">
            <label for="AgreementID" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.AgreementID' | translate }}</label>
            <div class="col-md-4">
                <select id="AgreementID" name="AgreementID" class="form-control parsley-validated"
                        ng-model="businessType.AgreementID"
                        ng-options="agreement.profileId as agreement.Name for agreement in agreements"
                        ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                    <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.BadDebtDeducted' | translate }}</label>
            <div class="col-md-2">
                <div class="btn-group">
                    <button class="btn {{businessType.BadDebtDeducted?'btn-primary active':'btn-default'}} btn-sm"
                            ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())"
                            ng-model="businessType.BadDebtDeducted" uib-btn-radio="true">{{ 'CommonLabels.Yes' | translate }}</button>
                    <button class="btn {{!businessType.BadDebtDeducted?'btn-primary active':'btn-default'}} btn-sm"
                            ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())"
                            ng-model="businessType.BadDebtDeducted" uib-btn-radio="false">{{ 'CommonLabels.No' | translate }}</button>
                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-10">
                <div class="divider"></div>
            </div>
        </div>

        <!-- Documents related form fields -->
        <div>
            <div class="form-group">
                <label for="CompanyProfileDocReq" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.CompanyProfileDocReq' | translate }}</label>
                <div class="col-md-4">
                    <select id="CompanyProfileDocReq" name="CompanyProfileDocReq" class="form-control parsley-validated"
                            ng-model="businessType.CompanyProfileDocReq"
                            ng-required="true"
                            ng-options="CompanyProfileDocReq as CompanyProfileDocReq for CompanyProfileDocReq in BUSINESS_MANAGEMENT_DOCUMENT_TYPES"
                            ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                        <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                    </select>
                    <ul ng-class="{ 'parsley-error-list': form.CompanyProfileDocReq.$dirty && form.CompanyProfileDocReq.$invalid }"
                        ng-show="form.CompanyProfileDocReq.$dirty && form.CompanyProfileDocReq.$invalid">
                        <li class="required" ng-show="form.CompanyProfileDocReq.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    </ul>
                </div>
            </div>

            <div class="form-group">
                <label for="CORDocReq" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.CORDocReq' | translate }}</label>
                <div class="col-md-4">
                    <select id="CORDocReq" name="CORDocReq" class="form-control parsley-validated"
                            ng-model="businessType.CORDocReq"
                            ng-required="true"
                            ng-options="CORDocReq as CORDocReq for CORDocReq in BUSINESS_MANAGEMENT_DOCUMENT_TYPES"
                            ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                        <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                    </select>
                    <ul ng-class="{ 'parsley-error-list': form.CORDocReq.$dirty && form.CORDocReq.$invalid }"
                        ng-show="form.CORDocReq.$dirty && form.CORDocReq.$invalid">
                        <li class="required" ng-show="form.CORDocReq.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    </ul>
                </div>
            </div>

            <div class="form-group">
                <label for="POACopyDocReq" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.POACopyDocReq' | translate }}</label>
                <div class="col-md-4">
                    <select id="POACopyDocReq" name="POACopyDocReq" class="form-control parsley-validated"
                            ng-model="businessType.POACopyDocReq"
                            ng-required="true"
                            ng-options="POACopyDocReq as POACopyDocReq for POACopyDocReq in BUSINESS_MANAGEMENT_DOCUMENT_TYPES"
                            ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                        <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                    </select>
                    <ul ng-class="{ 'parsley-error-list': form.POACopyDocReq.$dirty && form.POACopyDocReq.$invalid }"
                        ng-show="form.POACopyDocReq.$dirty && form.POACopyDocReq.$invalid">
                        <li class="required" ng-show="form.POACopyDocReq.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    </ul>
                </div>
            </div>

            <div class="form-group">
                <label for="CITCLicenseDocReq" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.CITCLicenseDocReq' | translate }}</label>
                <div class="col-md-4">
                    <select id="CITCLicenseDocReq" name="CITCLicenseDocReq" class="form-control parsley-validated"
                            ng-model="businessType.CITCLicenseDocReq"
                            ng-required="true"
                            ng-options="CITCLicenseDocReq as CITCLicenseDocReq for CITCLicenseDocReq in BUSINESS_MANAGEMENT_DOCUMENT_TYPES"
                            ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                        <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                    </select>
                    <ul ng-class="{ 'parsley-error-list': form.CITCLicenseDocReq.$dirty && form.CITCLicenseDocReq.$invalid }"
                        ng-show="form.CITCLicenseDocReq.$dirty && form.CITCLicenseDocReq.$invalid">
                        <li class="required" ng-show="form.CITCLicenseDocReq.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    </ul>

                </div>
            </div>

            <div class="form-group">
                <label for="MOCILicenseDocReq" class="col-md-3">{{ 'Subsystems.BusinessManagement.Operations.BusinessTypes.MOCILicenseDocReq' | translate }}</label>
                <div class="col-md-4">
                    <select id="MOCILicenseDocReq" name="MOCILicenseDocReq" class="form-control parsley-validated"
                            ng-model="businessType.MOCILicenseDocReq"
                            ng-required="true"
                            ng-options="MOCILicenseDocReq as MOCILicenseDocReq for MOCILicenseDocReq in BUSINESS_MANAGEMENT_DOCUMENT_TYPES"
                            ng-disabled="(businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate())">
                        <option value="">-- {{ 'CommonLabels.SelectOne' | translate }} --</option>
                    </select>
                    <ul ng-class="{ 'parsley-error-list': form.MOCILicenseDocReq.$dirty && form.MOCILicenseDocReq.$invalid }"
                        ng-show="form.MOCILicenseDocReq.$dirty && form.MOCILicenseDocReq.$invalid">
                        <li class="required" ng-show="form.MOCILicenseDocReq.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                    </ul>

                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-7 col-md-push-3">
                <button type="submit" class="btn btn-danger"
                        ng-disabled="form.$invalid || (businessType.profileId ? !AuthorizationService.canBizOperationsBusinessTypeUpdate() : !AuthorizationService.canBizOperationsBusinessTypeCreate()) || isNotChanged()"
                        ng-click="save(businessType);">
                    {{ 'CommonLabels.Save' | translate }}
                </button>
                <button type="reset" class="btn btn-default" ng-click="cancel();">
                    {{ 'CommonLabels.Cancel' | translate }}
                </button>
            </div>
        </div>

        </fieldset>
    </form>

</div>
