<div class="col-md-12" ng-if="showUserForm">
    <div class="portlet portlet-default">

        <div class="row">
            <div class="row panel-body">

                <div class="col-sm-12 col-md-12">
                    <form class="form-horizontal parsley-form" novalidate id="form" name="form" method="post" enctype="multipart/form-data" autocomplete="off">
                        <fieldset id="formFieldset">

                        <div class="form-group">
                            <label class="col-md-3">{{ 'Users.Form.UserName.Label' | translate }}</label>
                            <div class="col-md-4">
                                <input id="username" name="username" type="text" class="form-control"
                                       ng-model="userAccount.userName" ng-if="!userAccount.id"
                                       ng-maxlength="100" maxlength="100" autocomplete="off"
                                       ng-required="true"
                                       ng-disabled="!AuthorizationService.canCcUserCreate()"/>
                                <ul ng-class="{ 'parsley-error-list': form.username.$dirty && form.username.$invalid }" ng-show="form.username.$dirty && form.username.$invalid">
                                    <li class="required" ng-show="form.username.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                    <li class="required" ng-show="form.username.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 100} }}</li>
                                </ul>
                                <input id="username" name="username" type="text" class="form-control" ng-model="userAccount.userName" ng-if="userAccount.id" disabled/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'Users.Form.UserId.Label' | translate }}</label>
                            <div class="col-md-4">
                                <input id="id" name="id" type="text" class="form-control" ng-model="userAccount.id" ng-disabled="true"/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.CreatedOn' | translate }}</label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.CreatedOn | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET" disabled/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.CreatedBy' | translate }}</label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.CreatedBy" disabled/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.LastUpdatedOn' | translate }}</label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.LastUpdatedOn | date:'yyyy-MM-dd HH:mm:ss':DateTimeConstants.OFFSET" disabled/>
                            </div>
                        </div>

                        <div class="form-group" ng-if="userAccount.id">
                            <label class="col-md-3">{{ 'CommonLabels.LastUpdatedBy' | translate }}</label>
                            <div class="col-md-4">
                                <input type="text" class="form-control" ng-value="userAccount.entityAuditProfile.LastUpdatedBy" disabled/>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3">{{ 'Users.Form.ActiveDirectoryAuthentication.Label' | translate }}</label>
                            <div class="col-md-4">
                                <div class="btn-group">
                                    <button class="btn {{userAccount.userProfile.ActiveDirectoryAuthentication?'btn-primary active':'btn-default'}} btn-sm"
                                            ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"
                                            ng-model="userAccount.userProfile.ActiveDirectoryAuthentication" uib-btn-radio="true">{{ 'CommonLabels.Yes' | translate }}</button>
                                    <button class="btn {{!userAccount.userProfile.ActiveDirectoryAuthentication?'btn-primary active':'btn-default'}} btn-sm"
                                            ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"
                                            ng-model="userAccount.userProfile.ActiveDirectoryAuthentication" uib-btn-radio="false">{{ 'CommonLabels.No' | translate }}</button>
                                </div>
                            </div>
                        </div>

                        <div ng-show="!userAccount.userProfile.ActiveDirectoryAuthentication">
                            <div class="form-group">
                                <label for="password" class="col-md-3">{{ 'Users.Form.Password.Label' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="password" name="password" type="password" autocomplete="new-password" class="form-control"
                                           ng-model="userAccount.password"
                                           uib-popover="{{ 'CommonMessages.PasswordTooltip' | translate }}" popover-placement="top-left" popover-animation="false" popover-trigger="'focus'" popover-append-to-body="true"
                                           ng-minlength="8" ng-maxlength="100"
                                           ng-pattern="form.password.$dirty ? $root.Validators.UserPassword : false"
                                           ng-required="!userAccount.userProfile.ActiveDirectoryAuthentication" ng-change="resetConfirmPassword()"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.password.$dirty && form.password.$invalid }" ng-show="form.password.$dirty && form.password.$invalid">
                                        <li class="required" ng-show="!form.password.$error.minlength && form.password.$error.pattern">{{ 'CommonMessages.PasswordDoesNotMeetRequirements' | translate }}</li>
                                        <li class="required" ng-show="form.password.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.password.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 8 } }}</li>
                                        <li class="required" ng-show="form.password.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{ max_length: 100 } }}</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="confirmpassword" class="col-md-3">{{ 'Users.Form.ConfirmPassword.Label' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="confirmpassword" name="confirmpassword" type="password" autocomplete="new-password" class="form-control"
                                           ng-model="userAccount.confirmpassword"
                                           ng-minlength="8" ng-maxlength="100"
                                           ng-required="!userAccount.userProfile.ActiveDirectoryAuthentication" password-verify="userAccount.password"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.confirmpassword.$dirty && form.confirmpassword.$invalid }" ng-show="form.confirmpassword.$dirty && form.confirmpassword.$invalid">
                                        <li class="required" ng-show="form.confirmpassword.$error.passwordVerify">{{ 'CommonMessages.PasswordError' | translate }}</li>
                                        <li class="required" ng-show="form.confirmpassword.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.confirmpassword.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 8 } }}</li>
                                        <li class="required" ng-show="form.confirmpassword.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{ max_length: 100 } }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3">{{ 'Users.Form.Organization.Label' | translate }}</label>
                            <div class="col-md-4">
                                <div class="label label-default selected-item-label">
                                    {{getOrganizationName()}}
                                </div>
                            </div>
                        </div>

                        <div class="form-group" ng-if="SessionService.isUserAdmin()">
                            <label class="col-md-3">{{ 'Users.Form.State.Label' | translate }}</label>
                            <div class="col-md-4">
                                <select id="state" name="state" class="form-control parsley-validated"
                                        ng-model="userAccount.state"
                                        ng-options="state.value as (state.label | translate) for state in STATUS_TYPES"
                                        ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()">
                                </select>
                            </div>
                        </div>

                        <div class="form-group" ng-if="SessionService.isUserAdmin()">
                            <label for="userGroups" class="col-md-3">{{ 'Users.Form.UserGroups.Label' | translate }}</label>
                            <div class="col-md-4">
                                <ui-select id="userGroups" name="userGroups" multiple theme="bootstrap" allow-clear="true" append-to-body="true"
                                           ng-model="userAccount.userGroups"
                                           close-on-select="false"
                                           limit="20"
                                           ng-required="true"
                                           title="{{ 'CommonLabels.SelectOne' | translate }}"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()">
                                    <ui-select-match placeholder=" {{ 'CommonLabels.SelectFromTheList' | translate }}">
                                        {{ $item.name }}
                                    </ui-select-match>
                                    <ui-select-choices repeat="userGroupItem as userGroupItem in (userGroupList | filter: $select.search)">
                                        {{ userGroupItem.name }}
                                    </ui-select-choices>
                                </ui-select>
                                <ul ng-class="{ 'parsley-error-list': form.userGroups.$dirty && form.userGroups.$invalid }"
                                    ng-show="form.userGroups.$dirty && form.userGroups.$invalid">
                                    <li class="required" ng-show="form.userGroups.$error.required">{{ 'ScreeningLists.AddForm.Messages.Required' | translate }}</li>
                                    <li class="required" ng-show="form.userGroups.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 20} }}</li>
                                </ul>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-10">
                                <h5 class="portlet-title">
                                    {{ 'Users.Form.Details.Title' | translate }}
                                </h5>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label for="name" class="col-md-3">{{ 'Users.Form.Details.Name' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="name" name="name" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.Name"
                                           maxlength="50" ng-maxlength="50"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.name.$dirty && form.name.$invalid }" ng-show="form.name.$dirty && form.name.$invalid">
                                        <li class="required" ng-show="form.name.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 50} }}</li>
                                    </ul>
                                </div>
                            </div>
    
                            <div class="form-group">
                                <label for="surname" class="col-md-3">{{ 'Users.Form.Details.Surname' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="surname" name="surname" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.Surname"
                                           maxlength="50" ng-maxlength="50"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.surname.$dirty && form.surname.$invalid }" ng-show="form.surname.$dirty && form.surname.$invalid">
                                        <li class="required" ng-show="form.surname.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 50} }}</li>
                                    </ul>
                                </div>
                            </div>
    
                            <div class="form-group">
                                <label for="MobilePhone" class="col-md-3">{{ 'Users.Form.Details.MobilePhone' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="MobilePhone" name="MobilePhone" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.MobilePhone"
                                           ng-required="true"
                                           ng-minlength="5" maxlength="20" ng-maxlength="20"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.MobilePhone.$dirty && form.MobilePhone.$invalid }" ng-show="form.MobilePhone.$dirty && form.MobilePhone.$invalid">
                                        <li class="required" ng-show="form.MobilePhone.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.MobilePhone.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 5 } }}</li>
                                        <li class="required" ng-show="form.MobilePhone.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 20} }}</li>
                                    </ul>
                                </div>
                            </div>
    
                            <div class="form-group">
                                <label for="fixedPhone" class="col-md-3">{{ 'Users.Form.Details.FixedPhone' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="fixedPhone" name="fixedPhone" type="text" class="form-control"
                                           ng-model="userAccount.userProfile.FixedPhone"
                                           ng-minlength="5" maxlength="20" ng-maxlength="20"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.fixedPhone.$dirty && form.fixedPhone.$invalid }" ng-show="form.fixedPhone.$dirty && form.fixedPhone.$invalid">
                                        <li class="required" ng-show="form.fixedPhone.$error.minlength">{{ 'CommonMessages.MinLengthError' | translate:{ min_length: 5 } }}</li>
                                        <li class="required" ng-show="form.fixedPhone.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 20} }}</li>
                                    </ul>
                                </div>
                            </div>
    
                            <div class="form-group">
                                <label for="email" class="col-md-3">{{ 'Users.Form.Details.Email' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="email" name="email" type="email" class="form-control"
                                           ng-model="userAccount.userProfile.Email"
                                           ng-required="true"
                                           maxlength="100" ng-maxlength="100"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.email.$dirty && form.email.$invalid }"
                                        ng-show="form.email.$dirty && form.email.$invalid">
                                        <li class="required" ng-show="form.email.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.email.$error.email">{{ 'CommonMessages.InvalidEmail' | translate }}</li>
                                        <li class="required" ng-show="form.email.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 100} }}</li>
                                    </ul>
                                </div>
                            </div>
    
                            <div class="form-group">
                                <label for="supervisorEmail" class="col-md-3">{{ 'Users.Form.Details.SupervisorEmail' | translate }}</label>
                                <div class="col-md-4">
                                    <input id="supervisorEmail" name="supervisorEmail" type="email" class="form-control"
                                           ng-model="userAccount.userProfile.SupervisorEmail"
                                           ng-required="true"
                                           maxlength="100" ng-maxlength="100"
                                           ng-disabled="userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()"/>
                                    <ul ng-class="{ 'parsley-error-list': form.supervisorEmail.$dirty && form.supervisorEmail.$invalid }"
                                        ng-show="form.supervisorEmail.$dirty && form.supervisorEmail.$invalid">
                                        <li class="required" ng-show="form.supervisorEmail.$error.required">{{ 'CommonMessages.RequiredFieldError' | translate }}</li>
                                        <li class="required" ng-show="form.supervisorEmail.$error.email">{{ 'CommonMessages.InvalidEmail' | translate }}</li>
                                        <li class="required" ng-show="form.supervisorEmail.$error.maxlength">{{ 'CommonMessages.MaxLengthError' | translate:{max_length: 100} }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-md-4 col-md-push-3">
                                <button type="submit" class="btn btn-danger"
                                        ng-disabled="form.$invalid || (userAccount.id ? !AuthorizationService.canCcUserUpdate() : !AuthorizationService.canCcUserCreate()) || isNotChanged()"
                                        ng-click="save(userAccount);">
                                    {{ 'CommonLabels.Save' | translate }}
                                </button>
                                <button type="reset" class="btn btn-default" ng-click="cancel();">
                                    {{ 'CommonLabels.Cancel' | translate }}
                                </button>
                            </div>
                        </div>

                        </fieldset>
                    </form>
                </div>

            </div>
        </div>

    </div>
</div>
