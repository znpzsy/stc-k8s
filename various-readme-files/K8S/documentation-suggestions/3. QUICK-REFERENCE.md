# ConsolPortals - Quick Reference Cheat Sheet

## üöÄ Quick Commands Reference

### Docker Compose

```bash
# Start development environment (hot-reload)
make start dev
# OR
docker compose -f docker-compose_dev.yml up --build

# Start production environment
make start prod
# OR  
docker compose -f docker-compose_prod.yml up --build

# View logs
make logs dev
docker compose -f docker-compose_dev.yml logs -f

# Stop
make stop dev
docker compose -f docker-compose_dev.yml down

# Complete cleanup
make fresh dev
```

### Local Kubernetes - NodePort (Easiest)

```bash
# Install
kubectl create namespace stc-vcp-services
helm install consolportals . -f values.yaml -f values-local-nodeport.yaml -n stc-vcp-services

# Access
open http://localhost:30080/adminportal

# Upgrade
helm upgrade consolportals . -f values-local-nodeport.yaml -n stc-vcp-services

# Uninstall
helm uninstall consolportals -n stc-vcp-services
```

### Local Kubernetes - ClusterIP + Port Forward

```bash
# Install
helm install consolportals . -f values.yaml -f values-local.yaml -n stc-vcp-services

# Port forward
kubectl port-forward svc/consolportals-sa-stc-vcp-httpd-service 9080:80 -n stc-vcp-services &

# Stop port forwards
pkill -f "kubectl port-forward"
```

### Local Kubernetes - Ingress

```bash
# Install NGINX Ingress (one-time)
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.1/deploy/static/provider/cloud/deploy.yaml

# Install app
helm install consolportals . -f values.yaml -f values-local.yaml -n stc-vcp-services

# Access
open http://localhost/adminportal
```

### Corporate Kubernetes

```bash
# Build AMD64 images
docker buildx build --platform linux/amd64 \
  -t nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-httpd:1.0.0.1-amd64 \
  -f httpd/Dockerfile.vcp.prod ./httpd

# Push to registry
docker push nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-httpd:1.0.0.1-amd64

# Deploy
helm install consolportals . -f values.yaml -n stc-vcp-services

# Upgrade
helm upgrade consolportals . -f values.yaml -n stc-vcp-services
```

---

## üìä Deployment Method Comparison

| Feature | Docker Compose | Local K8s (NodePort) | Local K8s (ClusterIP) | Local K8s (Ingress) | Corporate K8s |
|---------|---------------|---------------------|----------------------|--------------------|--------------| 
| **Setup Time** | üü¢ 1 min | üü° 5 min | üü° 5 min | üî¥ 10 min | üî¥ 20 min |
| **Complexity** | üü¢ Easy | üü° Medium | üü° Medium | üî¥ Complex | üî¥ Complex |
| **Hot-Reload** | ‚úÖ Yes (dev) | ‚ùå No | ‚ùå No | ‚ùå No | ‚ùå No |
| **Port Forwarding** | ‚ùå No | ‚ùå No | ‚úÖ Required | ‚ùå No | Varies |
| **Production-Like** | üü° Somewhat | üü¢ Yes | üü¢ Yes | üü¢ Very | üü¢ Exact |
| **Best For** | Quick dev | Daily dev | Debugging | Full testing | Deployment |

---

## üåê Access URLs by Deployment Method

### Docker Compose - DEV
- Admin: http://localhost/adminportal
- CC: http://localhost/ccportal
- Partner: http://localhost/partnerportal
- HTTPS: https://localhost/adminportal

### Docker Compose - PROD
- Admin: http://localhost:9080/adminportal
- CC: http://localhost:9080/ccportal
- Partner: http://localhost:9080/partnerportal
- HTTPS: https://localhost:9443/adminportal

### Local K8s - NodePort
- Admin: http://localhost:30080/adminportal
- CC: http://localhost:30080/ccportal
- Partner: http://localhost:30080/partnerportal
- HTTPS: https://localhost:30443/adminportal
- Direct a3gw: http://localhost:30444/adminportal

### Local K8s - ClusterIP + Port Forward
- Admin: http://localhost:9080/adminportal
- CC: http://localhost:9080/ccportal
- Partner: http://localhost:9080/partnerportal
- Direct a3gw: http://localhost:9444/adminportal

### Local K8s - Ingress
- Admin: http://localhost/adminportal
- CC: http://localhost/ccportal
- Partner: http://localhost/partnerportal

### Corporate K8s
- Via hostname: https://consolportals.internal.telenity.com/adminportal
- Via port-forward: http://localhost:9080/adminportal

---

## üîß Debugging Commands

### Docker
```bash
# Check container status
docker ps

# View logs
docker logs <container-id> -f

# Shell into container
docker exec -it <container-name> bash

# Check what's using a port
lsof -ti:80 | xargs kill
```

### Kubernetes
```bash
# Check pod status
kubectl get pods -n stc-vcp-services

# View logs
kubectl logs -f deployment/consolportals-sa-stc-vcp-httpd-deployment -n stc-vcp-services

# Describe pod
kubectl describe pod <pod-name> -n stc-vcp-services

# Shell into pod
kubectl exec -it <pod-name> -n stc-vcp-services -- bash

# View events
kubectl get events -n stc-vcp-services --sort-by='.lastTimestamp'

# Check services
kubectl get svc -n stc-vcp-services

# Check ingress
kubectl get ingress -n stc-vcp-services
```

### Helm
```bash
# List releases
helm list -n stc-vcp-services

# Get values
helm get values consolportals -n stc-vcp-services

# Dry-run
helm install consolportals . --dry-run --debug -n stc-vcp-services

# History
helm history consolportals -n stc-vcp-services

# Rollback
helm rollback consolportals 1 -n stc-vcp-services
```

---

## üèóÔ∏è Architecture Ports

| Component | Port(s) | Purpose |
|-----------|---------|---------|
| httpd | 80, 443 | HTTP/HTTPS web server |
| a3gw | 8444, 8445 | API gateway (portal + auth) |
| adminportal | 8080 | Admin portal backend |
| ccportal | 8081 | CC portal backend |
| partnerportal | 8082 | Partner portal backend |

---

## üìã Image Registry Reference

### Local Development (Mac/ARM)
```
stc-vcp/httpd:latest
stc-vcp/a3gw:latest
stc-vcp/vcp-adminportal:latest
```

### Corporate Cluster (AMD64)
```
nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-httpd:1.0.0.1-amd64
nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-a3gw:1.0.0.1-amd64
nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-adminportal:1.0.0.1-amd64
```

---

## üéØ Common Tasks

### Make code changes and see them
**Docker Compose (dev):**
- Changes appear automatically (volumes mounted)

**Kubernetes:**
```bash
# Rebuild image
docker compose -f docker-compose_dev.yml build <service>

# Upgrade deployment
helm upgrade consolportals . -f values-local-nodeport.yaml -n stc-vcp-services
```

### Change configuration files
**Docker Compose:**
```bash
# Edit config in a3gw/vcp/conf.dev/
# Restart service
docker exec -it a3gw-1 pm2 restart all
```

**Kubernetes:**
```bash
# Edit config
# Rebuild and push image
# Upgrade helm release
```

### Switch between environments
```bash
# From Docker to K8s
docker compose -f docker-compose_dev.yml down
helm install consolportals . -f values-local-nodeport.yaml -n stc-vcp-services

# Between K8s methods
helm uninstall consolportals -n stc-vcp-services
helm install consolportals . -f values-local.yaml -n stc-vcp-services
```

---

## üÜò Troubleshooting Quick Fixes

### "Port already in use"
```bash
# Find and kill process
lsof -ti:80 | xargs kill
lsof -ti:30080 | xargs kill
```

### "Image pull error"
```bash
# Check image exists
docker images | grep consolportals

# For corporate cluster
docker pull nexus.telenity.com/com/telenity/consolportals-sa-stc-vcp-httpd:1.0.0.1-amd64
```

### "Pod CrashLoopBackOff"
```bash
# Check logs
kubectl logs <pod-name> -n stc-vcp-services

# Check events
kubectl describe pod <pod-name> -n stc-vcp-services
```

### "Can't access portal"
```bash
# Check pod status
kubectl get pods -n stc-vcp-services

# Check services
kubectl get svc -n stc-vcp-services

# Try direct pod access
kubectl port-forward <pod-name> 8080:8080 -n stc-vcp-services
```

### "Helm install fails"
```bash
# Check syntax
helm lint .

# Dry-run
helm install consolportals . --dry-run --debug -n stc-vcp-services

# Check existing releases
helm list -n stc-vcp-services
```

---

## üìö File Reference

| File | Purpose |
|------|---------|
| `GETTING-STARTED.md` | Main getting started guide |
| `README.md` | Original project README |
| `README-Helm.md` | Helm chart details |
| `README-LocalDevGuide.md` | Local K8s options |
| `README-Make.md` | Makefile commands |
| `README-Dockerization.md` | Docker implementation |
| `values.yaml` | Base Helm values (production) |
| `values-local.yaml` | Local K8s (Mac, ClusterIP/Ingress) |
| `values-local-nodeport.yaml` | Local K8s (NodePort) |
| `values-dev.yaml` | Dev environment |
| `docker-compose_dev.yml` | Docker dev with hot-reload |
| `docker-compose_prod.yml` | Docker production build |
| `Makefile` | Automation commands |

---

**Quick Navigation:**
- üìñ [Getting Started Guide](2.%20GETTING-STARTED.md) - Start here!
- üìò [Original README](README.md) - Project overview
- üîß [Helm Documentation](README-Helm.md) - Helm details
- üíª [Local Dev Guide](README-LocalDevGuide.md) - K8s options
